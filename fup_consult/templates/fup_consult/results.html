{% extends "fup_consult/base.html" %}

{% block title %}Resultados - {{ ruc }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
                <i class="bi bi-building"></i>
                Ficha del Proveedor
            </h3>
            <a href="{% url 'fup_consult:download_excel' ruc=ruc %}" class="btn btn-success">
                <i class="bi bi-file-earmark-excel"></i>
                Descargar Excel
            </a>
        </div>
    </div>

    <div class="card-body">
        <!-- Datos Generales -->
        <div class="section-card">
            <div class="section-title">
                <i class="bi bi-info-circle"></i> Datos Generales
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>RUC:</strong> {{ provider_data.general.ruc }}</p>
                        <p><strong>Razón Social:</strong> {{ provider_data.general.razon_social }}</p>
                        <p><strong>Estado:</strong> 
                            <span class="badge {% if provider_data.general.estado == 'ACTIVO' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ provider_data.general.estado }}
                            </span>
                        </p>
                        <p><strong>Condición:</strong> 
                            <span class="badge {% if provider_data.general.condicion == 'HABIDO' %}bg-success{% else %}bg-warning{% endif %}">
                                {{ provider_data.general.condicion }}
                            </span>
                        </p>
                        <p><strong>Tipo de Contribuyente:</strong> {{ provider_data.general.tipo_contribuyente }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Departamento:</strong> {{ provider_data.general.departamento }}</p>
                        <p><strong>Provincia:</strong> {{ provider_data.general.provincia }}</p>
                        <p><strong>Distrito:</strong> {{ provider_data.general.distrito }}</p>
                        <p><strong>Dirección:</strong> {{ provider_data.general.direccion }}</p>
                        {% if provider_data.general.telefonos %}
                        <p><strong>Teléfonos:</strong> {{ provider_data.general.telefonos|join:", " }}</p>
                        {% endif %}
                        {% if provider_data.general.emails %}
                        <p><strong>Emails:</strong> {{ provider_data.general.emails|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Socios y Accionistas -->
        <div class="section-card">
            <div class="section-title">
                <i class="bi bi-people"></i> Socios y Accionistas
            </div>
            <div class="card-body">
                {% if provider_data.socios %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre Completo</th>
                                <th>Tipo Doc.</th>
                                <th>N° Documento</th>
                                <th>Participación</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for socio in provider_data.socios %}
                            <tr>
                                <td>{{ socio.nombre_completo }}</td>
                                <td>{{ socio.tipo_documento }}</td>
                                <td>{{ socio.numero_documento }}</td>
                                <td>{{ socio.porcentaje_participacion|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay información de socios disponible.</p>
                {% endif %}
            </div>
        </div>

        <!-- Representantes Legales -->
        <div class="section-card">
            <div class="section-title">
                <i class="bi bi-person-badge"></i> Representantes Legales
            </div>
            <div class="card-body">
                {% if provider_data.representantes %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre Completo</th>
                                <th>Tipo Doc.</th>
                                <th>N° Documento</th>
                                <th>Cargo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rep in provider_data.representantes %}
                            <tr>
                                <td>{{ rep.nombre_completo }}</td>
                                <td>{{ rep.tipo_documento }}</td>
                                <td>{{ rep.numero_documento }}</td>
                                <td>{{ rep.cargo|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay información de representantes disponible.</p>
                {% endif %}
            </div>
        </div>

        <!-- Órganos de Administración -->
        <div class="section-card">
            <div class="section-title">
                <i class="bi bi-diagram-3"></i> Órganos de Administración
            </div>
            <div class="card-body">
                {% if provider_data.organos_administracion %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre Completo</th>
                                <th>Tipo Doc.</th>
                                <th>N° Documento</th>
                                <th>Cargo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for org in provider_data.organos_administracion %}
                            <tr>
                                <td>{{ org.nombre_completo }}</td>
                                <td>{{ org.tipo_documento }}</td>
                                <td>{{ org.numero_documento }}</td>
                                <td>{{ org.cargo }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay información de órganos de administración disponible.</p>
                {% endif %}
            </div>
        </div>

        <!-- Experiencia del Proveedor -->
        <div class="section-card">
            <div class="section-title">
                <i class="bi bi-briefcase"></i> Experiencia del Proveedor
            </div>
            <div class="card-body">
                {% if provider_data.experiencia %}
                <p class="mb-3">
                    <strong>Total de contratos:</strong> 
                    <span class="badge bg-info">{{ provider_data.experiencia|length }}</span>
                </p>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>N° Contrato</th>
                                <th>Entidad</th>
                                <th>Objeto</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for contrato in provider_data.experiencia|slice:":10" %}
                            <tr>
                                <td>{{ contrato.numero_contrato }}</td>
                                <td>{{ contrato.entidad }}</td>
                                <td>{{ contrato.objeto_contractual|truncatewords:10 }}</td>
                                <td>{{ contrato.estado|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if provider_data.experiencia|length > 10 %}
                <p class="text-muted small">
                    <i class="bi bi-info-circle"></i>
                    Mostrando los primeros 10 contratos. Descargue el Excel para ver todos.
                </p>
                {% endif %}
                {% else %}
                <p class="text-muted">No hay información de experiencia disponible.</p>
                {% endif %}
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="{% url 'fup_consult:search' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i>
                Nueva Consulta
            </a>
            <a href="{% url 'fup_consult:download_excel' ruc=ruc %}" class="btn btn-success">
                <i class="bi bi-file-earmark-excel"></i>
                Descargar Excel
            </a>
        </div>
    </div>
</div>
{% endblock %}
